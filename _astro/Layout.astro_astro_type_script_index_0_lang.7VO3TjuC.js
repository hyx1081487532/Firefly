import{j as b,k as E,l as v,B as T,m as y,n as I}from"./setting-utils.BhoJTznW.js";import{p as k,u as S}from"./url-utils._arQoKpP.js";import{s as x}from"./navBarConfig.CzDmlOGd.js";import"./zh_TW.vPzy7Va8.js";const f=!!document.getElementById("banner-wrapper");function d(o,t){document.addEventListener("click",e=>{let n=document.getElementById(o),i=e.target;if(i instanceof Node){for(let s of t){let a=document.getElementById(s);if(a==i||a?.contains(i))return}n.classList.add("float-panel-closed")}})}d("display-setting",["display-setting","display-settings-switch"]);d("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]);d("search-panel",["search-panel","search-bar","search-switch"]);d("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]);d("theme-mode-panel",["theme-mode-panel","scheme-switch"]);function h(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(t=>{if(!t.parentNode)return;const e=document.createElement("div");e.className="katex-display-container",t.parentNode.insertBefore(e,t),e.appendChild(t),e.style.cssText=`
			overflow-x: auto;
		`,t.setAttribute("data-scrollbar-initialized","true")})}function L(){x.backgroundWallpaper.mode==="banner"&&requestAnimationFrame(()=>{const t=document.getElementById("banner");t&&t.classList.remove("opacity-0","scale-105");const e=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');e&&(e.classList.remove("opacity-0","scale-105"),e.classList.add("opacity-100"))})}const B=()=>{window.swup.hooks.on("link:click",()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),document.documentElement.classList.add("is-page-transitioning"),f){const o=document.getElementById("navbar-wrapper");if(o&&document.body.classList.contains("lg:is-home")){const t=window.innerHeight*(y/100)-88;document.documentElement.scrollTop>=t&&o.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{if(h(),document.getElementById("toc-wrapper")!==null){const n=document.querySelector("table-of-contents");n&&typeof n.init=="function"&&setTimeout(()=>{n.init()},100)}const e=document.getElementById("navbar");e&&e.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection(),setTimeout(()=>{const n=localStorage.getItem("postListLayout");if(n){const i=document.getElementById("right-sidebar"),s=document.getElementById("main-grid");n==="grid"?(i&&(i.style.display="none"),s&&s.classList.add("grid-layout-active")):(i&&(i.style.display=""),s&&s.classList.remove("grid-layout-active"))}},50)}),window.swup.hooks.on("visit:start",o=>{const t=document.querySelector("body"),e=k(o.to.url,S("/"));e?t.classList.add("lg:is-home"):t.classList.remove("lg:is-home");const n=document.querySelector(".banner-text-overlay");n&&(e?n.classList.remove("hidden"):n.classList.add("hidden"));const i=document.getElementById("navbar");i&&(i.setAttribute("data-is-home",e.toString()),i.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const s=window.innerWidth<1024;if(s){const r=document.getElementById("post-list-container");r&&(r.style.transition="none")}const a=document.getElementById("banner-wrapper"),l=document.querySelector(".absolute.w-full.z-30");s&&a&&l?e?(l.style.transition="none",a.style.display="",setTimeout(()=>{a.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{l.classList.remove("mobile-main-no-banner"),setTimeout(()=>{l.style.transition=""},50)},150)):(a.classList.add("mobile-hide-banner"),setTimeout(()=>{l.classList.add("mobile-main-no-banner")},100)):!s&&a&&(a.style.display="",a.classList.remove("mobile-hide-banner"),l&&l.classList.remove("mobile-main-no-banner"));const g=document.getElementById("page-height-extend");g&&g.classList.remove("hidden");let w=document.getElementById("toc-wrapper");w&&w.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{const o=document.getElementById("page-height-extend");o&&o.classList.remove("hidden"),window.scrollTo({top:0,behavior:"instant"}),window.innerWidth<1024&&setTimeout(()=>{const a=document.getElementById("post-list-container");a&&(a.style.transition="")},600);const e=localStorage.getItem("theme")||"light";let n=!1;e==="system"?n=window.matchMedia("(prefers-color-scheme: dark)").matches:n=e==="dark";const i=n?v.darkTheme:v.lightTheme;document.documentElement.getAttribute("data-theme")!==i&&document.documentElement.setAttribute("data-theme",i),setTimeout(()=>{if(document.getElementById("tcomment")){const a=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(a),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",o=>{setTimeout(()=>{const t=document.getElementById("page-height-extend");t&&t.classList.add("hidden");const e=document.getElementById("toc-wrapper");e&&e.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)}),window.addEventListener("layoutChange",o=>{const t=o.detail.layout,e=document.getElementById("right-sidebar"),n=document.getElementById("main-grid"),i=document.getElementById("post-container"),s=document.getElementById("swup-container");i&&(i.classList.add("layout-switching"),setTimeout(()=>{i.classList.remove("layout-switching")},400)),s&&(s.classList.add("layout-transitioning"),setTimeout(()=>{s.classList.remove("layout-transitioning")},500)),t==="grid"?(e&&(e.style.transition="opacity 0.35s ease-in-out, transform 0.35s ease-in-out",e.style.opacity="0",e.style.transform="translateX(15px)",setTimeout(()=>{e.style.display="none",e.style.opacity="",e.style.transform=""},350)),n&&n.classList.add("grid-layout-active")):(e&&(e.style.display="",e.style.transition="opacity 0.35s ease-in-out, transform 0.35s ease-in-out",e.style.opacity="0",e.style.transform="translateX(15px)",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateX(0)"},50),setTimeout(()=>{e.style.transition=""},400)),n&&n.classList.remove("grid-layout-active"))})};window?.swup?.hooks?B():document.addEventListener("swup:enable",B);let c=document.getElementById("back-to-top-btn"),m=document.getElementById("toc-wrapper"),u=document.getElementById("navbar-wrapper");function A(){const o=document.documentElement.scrollTop,t=window.innerHeight*(y/100),e=[];c&&e.push(()=>{o>t?c.classList.remove("hide"):c.classList.add("hide")}),f&&m&&e.push(()=>{o>t?m.classList.remove("toc-hide"):m.classList.add("toc-hide")}),f&&u&&e.push(()=>{const i=document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024?I:y,s=window.innerHeight*(i/100)-88;o>=s?u.classList.add("navbar-hidden"):u.classList.remove("navbar-hidden")}),e.length>0&&requestAnimationFrame(()=>{e.forEach(n=>n())})}let p;window.addEventListener("scroll",()=>{p&&cancelAnimationFrame(p),p=requestAnimationFrame(A)},{passive:!0});window.onresize=()=>{let o=Math.floor(window.innerHeight*(T/100));o=o-o%4,document.documentElement.style.setProperty("--banner-height-extend",`${o}px`)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{L(),h()}):(L(),h());document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{b(),E()}):(b(),E());
